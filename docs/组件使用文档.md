# 组件使用文档

**版本**: v3.2.0  
**最后更新**: 2025-10-11

本文档包含所有自定义组件的详细使用说明。

---

## 📑 目录

1. [result-card - 结果卡片组件](#result-card)
2. [calculator-input - 计算器输入组件](#calculator-input)
3. [tool-card - 工具卡片组件](#tool-card)
4. [skeleton - 骨架屏组件](#skeleton)

---

## result-card

结果展示卡片组件，用于显示计算结果和元数据。

### 基础属性

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| title | String | '结果' | 卡片标题 |
| type | String | 'default' | 卡片类型：default/success/warning/error |
| result | String | '' | 结果文本（用于复制和导出） |
| hint | String | '' | 提示文本 |
| showCopy | Boolean | true | 是否显示复制按钮 |
| showExport | Boolean | false | 是否显示导出按钮 |
| showHistory | Boolean | false | 是否显示保存按钮 |

### 元数据属性（v2.1新增）

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| unit | String | '' | 单位 |
| precision | String | '' | 精度说明 |
| formula | String | '' | 计算公式 |
| conditions | Array/String | null | 计算条件 |
| warning | String | '' | 警告信息 |
| dataSource | String | '' | 数据来源 |
| showMetadata | Boolean | true | 是否显示元数据区域 |
| metadataExpanded | Boolean | false | 是否默认展开元数据 |

### 历史记录属性

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| historyType | String | '' | 历史记录类型 |
| historyInput | String | '' | 历史记录输入描述 |

### 事件

| 事件名 | 说明 | 回调参数 |
|--------|------|----------|
| copy | 复制完成时触发 | { text } |
| export | 导出完成时触发 | { text, fileName } |
| historysaved | 保存到历史完成时触发 | { type, title, input, result, metadata } |

### 基础使用

```xml
<result-card 
  title="计算结果"
  result="d = 2.456 Å"
  type="success"
>
  <view>晶面间距：2.456 Å</view>
</result-card>
```

### 完整使用（包含元数据）

```xml
<result-card 
  title="XRD计算结果"
  type="success"
  result="d = 2.456 Å"
  unit="Å (埃米)"
  precision="精度约 0.001 Å"
  formula="d = λ / (2sinθ)"
  conditions="{{['波长 λ = 1.5406 Å (Cu Kα)', '2θ = 36.5°', '温度 = 25°C']}}"
  dataSource="布拉格方程，基于CODATA 2018"
  showCopy="{{true}}"
  showExport="{{true}}"
  showHistory="{{true}}"
  historyType="xrd"
  historyInput="θ = 18.25°, λ = 1.5406 Å"
  showMetadata="{{true}}"
  metadataExpanded="{{false}}"
>
  <view class="result-value">
    <text class="label">晶面间距：</text>
    <text class="value">2.456 Å</text>
  </view>
</result-card>
```

### 带警告信息

```xml
<result-card 
  title="电化学计算"
  type="warning"
  result="E vs NHE = 0.234 V"
  unit="V (伏特)"
  precision="精度约 0.001 V"
  warning="温度超出常规范围(25±5°C)，结果可能存在偏差"
  formula="E(NHE) = E(ref) + E°(ref vs NHE) - 0.059×pH"
  conditions="{{['参比电极: Ag/AgCl', 'pH = 7.0', '温度 = 35°C']}}"
  dataSource="能斯特方程，参考IUPAC推荐值"
  showMetadata="{{true}}"
  metadataExpanded="{{true}}"
>
  <view>E vs NHE = 0.234 V</view>
</result-card>
```

### 在JS中动态设置

```javascript
Page({
  data: {
    resultData: {
      type: 'success',
      result: '',
      unit: '',
      precision: '',
      formula: '',
      conditions: [],
      warning: '',
      dataSource: ''
    }
  },
  
  calculate() {
    const result = xrdUtil.dFromTheta2(this.data.theta, this.data.lambda);
    
    if (result.error) {
      this.setData({
        'resultData.type': 'error',
        'resultData.result': result.error,
        'resultData.warning': result.error
      });
    } else {
      this.setData({
        'resultData.type': 'success',
        'resultData.result': `d = ${result.d.toFixed(4)} ${result.unit}`,
        'resultData.unit': result.unit,
        'resultData.precision': result.precision,
        'resultData.formula': result.formula,
        'resultData.conditions': result.conditions,
        'resultData.warning': result.warning || '',
        'resultData.dataSource': 'CODATA 2018'
      });
    }
  }
});
```

---

## calculator-input

计算器风格的数字输入组件。

### 属性

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| label | String | '' | 输入框标签 |
| value | String/Number | '' | 输入值 |
| placeholder | String | '请输入' | 占位符 |
| unit | String | '' | 单位显示 |
| type | String | 'number' | 输入类型：text/number/digit |
| disabled | Boolean | false | 是否禁用 |

### 事件

| 事件名 | 说明 | 回调参数 |
|--------|------|----------|
| input | 输入时触发 | { value } |
| change | 值改变时触发 | { value } |

### 使用示例

```xml
<calculator-input
  label="2θ角度"
  value="{{theta}}"
  placeholder="请输入角度"
  unit="°"
  type="digit"
  bind:input="handleThetaInput"
/>
```

```javascript
handleThetaInput(e) {
  this.setData({ theta: e.detail.value });
}
```

---

## tool-card

工具卡片组件，用于首页工具列表。

### 属性

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| icon | String | '' | 图标（Emoji或图片路径） |
| title | String | '' | 工具标题 |
| description | String | '' | 工具描述 |
| path | String | '' | 跳转路径 |
| size | String | 'normal' | 尺寸：normal/large/small |

### 事件

| 事件名 | 说明 | 回调参数 |
|--------|------|----------|
| click | 点击时触发 | { path } |

### 使用示例

```xml
<tool-card
  icon="📐"
  title="XRD计算"
  description="布拉格方程、d值计算"
  path="/pages/advanced/xrd/xrd"
  size="normal"
  bind:click="handleToolClick"
/>
```

```javascript
handleToolClick(e) {
  wx.navigateTo({
    url: e.detail.path
  });
}
```

---

## skeleton

骨架屏加载组件，用于改善加载体验。

### 属性

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| type | String | 'card' | 骨架类型：card/list/tool/table |
| rows | Number | 3 | 显示的行数 |
| loading | Boolean | true | 是否显示骨架屏 |

### 骨架类型说明

#### card - 卡片骨架
- 适用于：详情页、卡片列表
- 结构：头像 + 3行文字

#### list - 列表骨架
- 适用于：历史记录、普通列表
- 结构：圆形图标 + 2行文字

#### tool - 工具卡片骨架
- 适用于：首页工具网格
- 结构：方形图标 + 2行文字

#### table - 表格骨架
- 适用于：数据表格
- 结构：3列数据行

### 使用示例

#### 基础使用

```xml
<skeleton type="tool" rows="6" loading="{{loading}}"></skeleton>
```

#### 配合实际内容

```xml
<view wx:if="{{loading}}">
  <skeleton type="card" rows="5"></skeleton>
</view>
<view wx:else class="content">
  <!-- 实际内容 -->
</view>
```

#### 在半导体页面中的应用

```xml
<view class="material-grid">
  <view wx:if="{{loading}}">
    <skeleton type="tool" rows="6"></skeleton>
  </view>
  <view wx:else class="material-list">
    <view wx:for="{{materials}}" wx:key="index">
      <!-- 材料卡片 -->
    </view>
  </view>
</view>
```

```javascript
Page({
  data: {
    loading: true,
    materials: []
  },
  
  onLoad() {
    this.loadMaterials();
  },
  
  async loadMaterials() {
    this.setData({ loading: true });
    
    // 模拟加载
    setTimeout(() => {
      this.setData({
        loading: false,
        materials: [...] // 实际数据
      });
    }, 1500);
  }
});
```

### 动画效果

骨架屏内置渐变扫光动画：
- 动画时长：1.5秒
- 循环播放
- 背景渐变：#f0f0f0 → #e0e0e0 → #f0f0f0
- 使用CSS动画，性能优秀

### 自定义样式

可以通过全局样式覆盖骨架屏样式：

```css
/* 在页面的 wxss 中 */
.skeleton {
  background: #f5f5f5 !important;
}

.skeleton-item {
  background: linear-gradient(
    90deg,
    #e8e8e8 25%,
    #d8d8d8 50%,
    #e8e8e8 75%
  ) !important;
}
```

---

## 组件通信

### 父组件向子组件传递数据

```xml
<!-- 父组件 -->
<result-card title="{{resultTitle}}" result="{{resultText}}" />
```

### 子组件向父组件传递数据

```xml
<!-- 父组件 -->
<result-card bind:copy="handleCopy" />
```

```javascript
// 父组件
handleCopy(e) {
  console.log('复制的内容:', e.detail.text);
}

// 子组件
this.triggerEvent('copy', { text: this.properties.result });
```

---

## 最佳实践

### 1. 使用 result-card 显示计算结果

✅ **推荐**:
```xml
<result-card
  title="计算结果"
  result="{{resultText}}"
  unit="{{unit}}"
  precision="{{precision}}"
  formula="{{formula}}"
  conditions="{{conditions}}"
  dataSource="{{dataSource}}"
  showMetadata="{{true}}"
/>
```

❌ **不推荐**:
```xml
<view class="result">
  <text>{{resultText}}</text>
</view>
```

### 2. 使用 skeleton 改善加载体验

✅ **推荐**:
```xml
<view wx:if="{{loading}}">
  <skeleton type="card" rows="5" />
</view>
<view wx:else>
  <!-- 内容 -->
</view>
```

❌ **不推荐**:
```xml
<view wx:if="{{loading}}">
  <text>加载中...</text>
</view>
```

### 3. 传递完整的元数据

✅ **推荐**:
```javascript
this.setData({
  resultText: `d = ${result.d} Å`,
  unit: result.unit,
  precision: result.precision,
  formula: result.formula,
  conditions: result.conditions,
  dataSource: 'CODATA 2018'
});
```

❌ **不推荐**:
```javascript
this.setData({
  resultText: `d = ${result.d} Å`
  // 缺少元数据
});
```

---

## 故障排查

### result-card 不显示元数据

**原因**: 元数据属性为空或未传递  
**解决**: 确保传递了至少一个元数据属性

### skeleton 不显示动画

**原因**: 可能是样式冲突  
**解决**: 检查页面样式是否覆盖了 skeleton 样式

### tool-card 点击无反应

**原因**: 未绑定 click 事件或 path 为空  
**解决**: 确保传递了 path 属性并绑定了事件

---

## 更新日志

### v2.1.0 (2025-10-10)
- ✨ result-card 增加元数据支持
- ✨ 新增 skeleton 组件
- 🐛 修复 result-card 的 typeof 问题

### v2.0.0 (2025-10-01)
- ✨ 初始版本
- ✨ result-card, calculator-input, tool-card

---

**维护者**: 项目开发团队  
**最后更新**: 2025-10-10

