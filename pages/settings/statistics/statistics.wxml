<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- æ— æ•°æ®æç¤º -->
  <view class="empty-container" wx:if="{{!loading && !hasData}}">
    <view class="empty-icon">ğŸ“Š</view>
    <view class="empty-text">æš‚æ— ç»Ÿè®¡æ•°æ®</view>
    <view class="empty-desc">å¼€å§‹åˆ†äº«è®¡ç®—ç»“æœåå°†æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯</view>
  </view>

  <!-- æœ‰æ•°æ®æ—¶æ˜¾ç¤º -->
  <view wx:if="{{!loading && hasData}}">
    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="overview-card">
      <view class="card-title">
        <text class="title-icon">ğŸ“ˆ</text>
        <text class="title-text">ç»Ÿè®¡æ¦‚è§ˆ</text>
      </view>

      <view class="overview-grid">
        <view class="grid-item">
          <view class="item-value">{{overview.totalShares}}</view>
          <view class="item-label">æ€»åˆ†äº«æ¬¡æ•°</view>
        </view>
        <view class="grid-item">
          <view class="item-value">{{overview.recentShares7Days}}</view>
          <view class="item-label">æœ€è¿‘7å¤©</view>
        </view>
        <view class="grid-item">
          <view class="item-value">{{overview.recentShares30Days}}</view>
          <view class="item-label">æœ€è¿‘30å¤©</view>
        </view>
        <view class="grid-item">
          <view class="item-value">{{overview.avgSharesPerDay}}</view>
          <view class="item-label">å¹³å‡æ¯æ—¥</view>
        </view>
      </view>
    </view>

    <!-- å‘¨æœˆå¯¹æ¯” -->
    <view class="trend-cards">
      <view class="trend-card" wx:if="{{weeklyStats}}">
        <view class="trend-label">æœ¬å‘¨åˆ†äº«</view>
        <view class="trend-value">{{weeklyStats.thisWeek}}</view>
        <view class="trend-change {{weeklyStats.trend}}">
          <text class="change-icon">{{weeklyStats.trend === 'up' ? 'ğŸ“ˆ' : weeklyStats.trend === 'down' ? 'ğŸ“‰' : 'â¡ï¸'}}</text>
          <text class="change-text">{{weeklyStats.change}}%</text>
        </view>
        <view class="trend-compare">ä¸Šå‘¨: {{weeklyStats.lastWeek}}</view>
      </view>

      <view class="trend-card" wx:if="{{monthlyStats}}">
        <view class="trend-label">æœ¬æœˆåˆ†äº«</view>
        <view class="trend-value">{{monthlyStats.thisMonth}}</view>
        <view class="trend-change {{monthlyStats.trend}}">
          <text class="change-icon">{{monthlyStats.trend === 'up' ? 'ğŸ“ˆ' : monthlyStats.trend === 'down' ? 'ğŸ“‰' : 'â¡ï¸'}}</text>
          <text class="change-text">{{monthlyStats.change}}%</text>
        </view>
        <view class="trend-compare">ä¸Šæœˆ: {{monthlyStats.lastMonth}}</view>
      </view>
    </view>

    <!-- çƒ­é—¨å·¥å…· TOP 10 -->
    <view class="section-card">
      <view class="section-header" bindtap="toggleSection" data-section="TopTools">
        <view class="header-left">
          <text class="header-icon">ğŸ”¥</text>
          <text class="header-title">çƒ­é—¨å·¥å…· TOP 10</text>
        </view>
        <text class="toggle-icon">{{showTopTools ? 'â–¼' : 'â–¶'}}</text>
      </view>

      <view class="section-content" wx:if="{{showTopTools}}">
        <view class="rank-list">
          <view class="rank-item" wx:for="{{topTools}}" wx:key="tool">
            <view class="rank-left">
              <text class="rank-number">{{index + 1}}</text>
              <text class="rank-name">{{item.toolName}}</text>
            </view>
            <view class="rank-right">
              <text class="rank-count">{{item.count}}æ¬¡</text>
              <view class="rank-bar">
                <view class="bar-fill" style="width: {{item.percentage}}%"></view>
              </view>
              <text class="rank-percent">{{item.percentage}}%</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åˆ†äº«æ¸ é“åˆ†å¸ƒ -->
    <view class="section-card">
      <view class="section-header" bindtap="toggleSection" data-section="Channels">
        <view class="header-left">
          <text class="header-icon">ğŸ“¤</text>
          <text class="header-title">åˆ†äº«æ¸ é“åˆ†å¸ƒ</text>
        </view>
        <text class="toggle-icon">{{showChannels ? 'â–¼' : 'â–¶'}}</text>
      </view>

      <view class="section-content" wx:if="{{showChannels}}">
        <view class="channel-list">
          <view class="channel-item" wx:for="{{channelDistribution}}" wx:key="channel">
            <view class="channel-info">
              <text class="channel-name">{{item.channelName}}</text>
              <text class="channel-count">{{item.count}}æ¬¡</text>
            </view>
            <view class="channel-bar">
              <view class="bar-fill" style="width: {{item.percentage}}%"></view>
            </view>
            <text class="channel-percent">{{item.percentage}}%</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ä½¿ç”¨æ—¶æ®µåˆ†å¸ƒ -->
    <view class="section-card">
      <view class="section-header" bindtap="toggleSection" data-section="Hourly">
        <view class="header-left">
          <text class="header-icon">ğŸ•</text>
          <text class="header-title">ä½¿ç”¨æ—¶æ®µåˆ†å¸ƒ</text>
        </view>
        <text class="toggle-icon">{{showHourly ? 'â–¼' : 'â–¶'}}</text>
      </view>

      <view class="section-content" wx:if="{{showHourly}}">
        <!-- é«˜å³°æ—¶æ®µ -->
        <view class="peak-hours">
          <text class="peak-title">ğŸ“ é«˜å³°æ—¶æ®µ TOP 5</text>
          <view class="peak-list">
            <view class="peak-item" wx:for="{{peakHours}}" wx:key="hour">
              <text class="peak-hour">{{item.hourLabel}}</text>
              <text class="peak-period">({{item.period}})</text>
              <text class="peak-count">{{item.count}}æ¬¡</text>
            </view>
          </view>
        </view>

        <!-- 24å°æ—¶åˆ†å¸ƒå›¾ -->
        <view class="hourly-chart">
          <view class="chart-item" wx:for="{{hourlyDistribution}}" wx:key="hour">
            <view class="chart-bar">
              <view class="bar-fill" style="height: {{item.percentage > 0 ? item.percentage : 2}}%">
                <text class="bar-value" wx:if="{{item.count > 0}}">{{item.count}}</text>
              </view>
            </view>
            <text class="chart-label">{{item.hour}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ¯æ—¥è¶‹åŠ¿ï¼ˆæœ€è¿‘7å¤©ï¼‰ -->
    <view class="section-card">
      <view class="section-header" bindtap="toggleSection" data-section="Daily">
        <view class="header-left">
          <text class="header-icon">ğŸ“…</text>
          <text class="header-title">æ¯æ—¥è¶‹åŠ¿ï¼ˆæœ€è¿‘7å¤©ï¼‰</text>
        </view>
        <text class="toggle-icon">{{showDaily ? 'â–¼' : 'â–¶'}}</text>
      </view>

      <view class="section-content" wx:if="{{showDaily}}">
        <view class="daily-chart">
          <view class="chart-item" wx:for="{{dailyTrend}}" wx:key="date">
            <view class="chart-bar">
              <view class="bar-fill" style="height: {{item.count * 10 > 100 ? 100 : item.count * 10}}%">
                <text class="bar-value" wx:if="{{item.count > 0}}">{{item.count}}</text>
              </view>
            </view>
            <text class="chart-label">{{item.dateLabel}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç”¨æˆ·åå¥½åˆ†æ -->
    <view class="preference-card" wx:if="{{userPreferences}}">
      <view class="card-title">
        <text class="title-icon">ğŸ’¡</text>
        <text class="title-text">åå¥½åˆ†æ</text>
      </view>

      <view class="preference-content">
        <view class="pref-item" wx:if="{{userPreferences.favoriteTools.length > 0}}">
          <text class="pref-label">æœ€å¸¸ç”¨å·¥å…·ï¼š</text>
          <text class="pref-value">{{userPreferences.favoriteTools[0].toolName}}</text>
        </view>

        <view class="pref-item" wx:if="{{userPreferences.preferredChannel}}">
          <text class="pref-label">åå¥½æ¸ é“ï¼š</text>
          <text class="pref-value">{{userPreferences.preferredChannel.channelName}}</text>
        </view>

        <view class="pref-item" wx:if="{{userPreferences.activeHours.length > 0}}">
          <text class="pref-label">æ´»è·ƒæ—¶æ®µï¼š</text>
          <text class="pref-value">{{userPreferences.activeHours[0].hourLabel}} ({{userPreferences.activeHours[0].period}})</text>
        </view>

        <view class="pref-item" wx:if="{{userPreferences.usagePattern}}">
          <text class="pref-label">ä½¿ç”¨æ¨¡å¼ï¼š</text>
          <text class="pref-value">{{userPreferences.usagePattern.pattern === 'morning' ? 'æ—©èµ·å‹' : userPreferences.usagePattern.pattern === 'evening' ? 'å¤œçŒ«å‹' : 'å‡è¡¡å‹'}}</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button class="action-btn primary" bindtap="exportReport">
        <text class="btn-icon">ğŸ“¤</text>
        <text class="btn-text">å¯¼å‡ºæŠ¥å‘Š</text>
      </button>

      <button class="action-btn danger" bindtap="clearStatistics">
        <text class="btn-icon">ğŸ—‘ï¸</text>
        <text class="btn-text">æ¸…ç©ºç»Ÿè®¡</text>
      </button>
    </view>
  </view>
</view>

