<!--数据备份管理页面-->
<view class="backup-page">
  <!-- 顶部统计卡片 -->
  <view class="stats-card">
    <view class="stats-row">
      <view class="stat-item">
        <text class="stat-value">{{backupList.length}}</text>
        <text class="stat-label">备份数量</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-value">{{backupStats.totalSizeText}} KB</text>
        <text class="stat-label">总大小</text>
      </view>
    </view>
  </view>

  <!-- 自动备份设置 -->
  <view class="settings-section">
    <view class="settings-header">
      <text class="settings-title">⚙️ 自动备份设置</text>
    </view>
    
    <view class="setting-item">
      <view class="setting-label">
        <text class="setting-name">自动备份</text>
        <text class="setting-desc">每24小时自动备份一次</text>
      </view>
      <switch checked="{{autoBackupEnabled}}" bindchange="toggleAutoBackup" color="#1AAD19"/>
    </view>

    <view class="setting-item" bindtap="setBackupInterval">
      <view class="setting-label">
        <text class="setting-name">备份间隔</text>
        <text class="setting-desc">点击设置备份频率</text>
      </view>
      <text class="setting-arrow">›</text>
    </view>

    <view class="setting-item" bindtap="setMaxBackups">
      <view class="setting-label">
        <text class="setting-name">保留数量</text>
        <text class="setting-desc">最多保留7个备份</text>
      </view>
      <text class="setting-arrow">›</text>
    </view>
  </view>

  <!-- 快速操作 -->
  <view class="action-section">
    <button 
      class="action-button primary" 
      bindtap="createManualBackup" 
      disabled="{{isLoading}}"
    >
      <text class="button-icon">💾</text>
      <text class="button-text">立即备份</text>
    </button>
  </view>

  <!-- 备份列表 -->
  <view class="backup-list-section">
    <view class="section-header">
      <text class="section-title">📦 备份列表</text>
      <text class="section-count">{{backupList.length}} 个备份</text>
    </view>

    <view wx:if="{{backupList.length === 0}}" class="empty-state">
      <text class="empty-icon">📂</text>
      <text class="empty-text">暂无备份</text>
      <text class="empty-hint">点击「立即备份」创建第一个备份</text>
    </view>

    <view wx:else class="backup-list">
      <view 
        wx:for="{{backupList}}" 
        wx:key="id" 
        class="backup-item"
      >
        <view class="backup-header">
          <view class="backup-icon">
            <text>{{item.name.includes('auto') ? '🤖' : '👤'}}</text>
          </view>
          <view class="backup-info">
            <text class="backup-name">{{item.name}}</text>
            <text class="backup-date">{{item.dateStr}}</text>
          </view>
          <text class="backup-size">{{item.sizeText}} KB</text>
        </view>

        <view class="backup-actions">
          <view class="action-btn info" bindtap="showBackupInfo" data-backup="{{item}}">
            <text class="action-icon">ℹ️</text>
            <text class="action-label">详情</text>
          </view>
          <view class="action-btn restore" bindtap="showRestoreDialog" data-backup="{{item}}">
            <text class="action-icon">♻️</text>
            <text class="action-label">恢复</text>
          </view>
          <view class="action-btn delete" bindtap="deleteBackup" data-backup="{{item}}">
            <text class="action-icon">🗑️</text>
            <text class="action-label">删除</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 恢复选项弹窗 -->
  <view wx:if="{{showRestoreOptions}}" class="modal-overlay" bindtap="closeRestoreOptions">
    <view class="restore-modal" catchtap="doNothing">
      <view class="modal-header">
        <text class="modal-title">恢复选项</text>
        <text class="modal-close" bindtap="closeRestoreOptions">✕</text>
      </view>

      <view class="modal-content">
        <text class="modal-subtitle">选择要恢复的数据</text>
        
        <view class="option-list">
          <view class="option-item">
            <checkbox checked="{{restoreOptions.importHistory}}" bindtap="toggleRestoreOption" data-option="importHistory"/>
            <text class="option-label">历史记录</text>
          </view>
          <view class="option-item">
            <checkbox checked="{{restoreOptions.importFavorites}}" bindtap="toggleRestoreOption" data-option="importFavorites"/>
            <text class="option-label">收藏</text>
          </view>
          <view class="option-item">
            <checkbox checked="{{restoreOptions.importRecentTools}}" bindtap="toggleRestoreOption" data-option="importRecentTools"/>
            <text class="option-label">最近使用</text>
          </view>
          <view class="option-item">
            <checkbox checked="{{restoreOptions.importSearchHistory}}" bindtap="toggleRestoreOption" data-option="importSearchHistory"/>
            <text class="option-label">搜索历史</text>
          </view>
          <view class="option-item">
            <checkbox checked="{{restoreOptions.importPreferences}}" bindtap="toggleRestoreOption" data-option="importPreferences"/>
            <text class="option-label">偏好设置</text>
          </view>
        </view>

        <view class="divider"></view>

        <view class="merge-mode-section">
          <text class="modal-subtitle">恢复模式</text>
          <view class="mode-options">
            <view class="mode-option {{!restoreOptions.mergeMode ? 'active' : ''}}" bindtap="toggleMergeMode">
              <text class="mode-icon">🔄</text>
              <text class="mode-name">覆盖模式</text>
              <text class="mode-desc">替换现有数据</text>
            </view>
            <view class="mode-option {{restoreOptions.mergeMode ? 'active' : ''}}" bindtap="toggleMergeMode">
              <text class="mode-icon">➕</text>
              <text class="mode-name">合并模式</text>
              <text class="mode-desc">保留并合并数据</text>
            </view>
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <button class="modal-button cancel" bindtap="closeRestoreOptions">取消</button>
        <button class="modal-button confirm" bindtap="confirmRestore">确认恢复</button>
      </view>
    </view>
  </view>

  <!-- 提示信息 -->
  <view class="tips-section">
    <view class="tip-item">
      <text class="tip-icon">💡</text>
      <text class="tip-text">自动备份会在每24小时自动创建一次备份</text>
    </view>
    <view class="tip-item">
      <text class="tip-icon">⚠️</text>
      <text class="tip-text">备份数据存储在本地，卸载小程序会丢失所有备份</text>
    </view>
    <view class="tip-item">
      <text class="tip-icon">📌</text>
      <text class="tip-text">建议定期导出重要数据保存到电脑</text>
    </view>
  </view>
</view>

