<view class="electrochem-page">
  <view class="page-header">
    <text class="header-icon">⚡</text>
    <view class="header-content">
      <view class="header-title">电化学计算</view>
      <view class="header-desc">电极电位换算、Nernst方程计算</view>
    </view>
  </view>

  <view class="section-card">
    <view class="tool-tabs">
      <view wx:for="{{tools}}" wx:key="id" class="tool-tab {{currentTool === item.id ? 'active' : ''}}" data-tool="{{item.id}}" bindtap="switchTool">
        <text class="tab-icon">{{item.icon}}</text>
        <text class="tab-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- 电极电位换算 -->
  <view wx:if="{{currentTool === 'convert'}}" class="tool-content">
    <view class="section-card">
      <view class="section-title">🔄 电极电位换算</view>
      <view class="section-description">不同参比电极之间的电位换算</view>
      
      <view class="form-section">
        <view class="form-row">
          <view class="form-label">源参比电极</view>
          <picker mode="selector" range="{{references}}" value="{{fromRefIndex}}" bindchange="handleFromRefChange">
            <view class="picker-display">{{references[fromRefIndex]}}<text class="picker-arrow">▼</text></view>
          </picker>
        </view>
        
        <calculator-input label="电位值 (V)" type="digit" value="{{potential}}" placeholder="例如：0.5" bindinput="handlePotentialInput" />
        
        <view class="form-row">
          <view class="form-label">目标参比电极</view>
          <picker mode="selector" range="{{references}}" value="{{toRefIndex}}" bindchange="handleToRefChange">
            <view class="picker-display">{{references[toRefIndex]}}<text class="picker-arrow">▼</text></view>
          </picker>
        </view>
        
        <view class="action-buttons">
          <button class="btn-primary" bindtap="convertPotential">转换</button>
          <button class="btn-secondary" bindtap="resetConvert">清空</button>
        </view>
      </view>
      
      <result-card wx:if="{{convertResult}}" title="转换结果" result="{{convertResultText}}" show-copy="{{true}}" show-export="{{true}}" show-history="{{true}}" history-type="electrochem" history-input="{{convertHistoryInput}}" unit="{{convertUnit}}" formula="{{convertFormula}}" data-source="电化学单位换算" show-metadata="{{true}}" metadata-expanded="{{false}}">
        <view class="result-value">{{convertResult}}</view>
      </result-card>
    </view>
  </view>

  <!-- Nernst方程 -->
  <view wx:if="{{currentTool === 'nernst'}}" class="tool-content">
    <view class="section-card">
      <view class="section-title">⚛️ Nernst方程计算</view>
      <view class="section-description">E = E° - (RT/nF)lnQ</view>
      
      <view class="form-section">
        <calculator-input label="标准电极电位 E° (V)" type="digit" value="{{e0}}" placeholder="例如：0.34" bindinput="handleE0Input" />
        <calculator-input label="温度 T (°C)" type="digit" value="{{temperature}}" placeholder="25" hint="默认25°C" bindinput="handleTemperatureInput" />
        <calculator-input label="电子转移数 n" type="digit" value="{{electronNum}}" placeholder="例如：2" bindinput="handleElectronNumInput" />
        <calculator-input label="反应商 Q" type="digit" value="{{reactionQ}}" placeholder="例如：0.1" hint="Q=[生成物]/[反应物]" bindinput="handleQInput" />
        
        <view class="action-buttons">
          <button class="btn-primary" bindtap="calculateNernst">计算</button>
          <button class="btn-secondary" bindtap="resetNernst">清空</button>
        </view>
      </view>
      
      <result-card wx:if="{{nernstResult}}" title="计算结果" result="{{nernstResultText}}" hint="{{nernstHint}}" show-copy="{{true}}" show-export="{{true}}" show-history="{{true}}" history-type="electrochem" history-input="{{nernstHistoryInput}}" unit="V" precision="小数点后4位" formula="E = E° - (RT/nF)ln(Q)" warning="{{nernstWarning}}" data-source="Nernst方程" show-metadata="{{true}}" metadata-expanded="{{false}}">
        <view class="result-value">{{nernstResult}}</view>
      </result-card>
      
      <view class="info-card">
        <view class="info-header"><text class="info-icon">📖</text><text>Nernst方程</text></view>
        <view class="info-content">
          <view class="formula-item">
            <text class="formula-label">标准形式：</text>
            <text class="formula">E = E° - (RT/nF)lnQ</text>
          </view>
          <view class="formula-item">
            <text class="formula-label">常用形式（25°C）：</text>
            <text class="formula">E = E° - (0.05916/n)log₁₀Q</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <view class="tip-card">
    <view class="tip-header"><text class="tip-icon">💡</text><text>使用提示</text></view>
    <view class="tip-content">
      <text>• NHE (SHE)：标准氢电极，E = 0 V</text>
      <text>• SCE：饱和甘汞电极，E = +0.241 V vs NHE</text>
      <text>• Ag/AgCl：银/氯化银电极，约+0.197 V vs NHE</text>
      <text>• 电位换算：E(NHE) = E(参比) + ΔE(参比→NHE)</text>
    </view>
  </view>
</view>

