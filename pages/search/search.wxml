<!--å…¨å±€æœç´¢é¡µé¢-->
<view class="search-page {{themeClass}}">
  <!-- å­¦æœ¯é£æ ¼å…¨å±€æœç´¢ -->
  <view class="search-header">
    <search-input
      value="{{searchKeyword}}"
      placeholder="æœç´¢å·¥å…·ã€æ•°æ®ã€å…¬å¼..."
      enableHistory="{{true}}"
      historyKey="global-search"
      hotSearches="{{hotSearches}}"
      showHot="{{!searchKeyword && !searchResults.length}}"
      bindinput="handleSearchInput"
      bindsearch="handleSearchConfirm"
      bindclear="clearSearch"
    />
    
    <!-- æœç´¢åŠŸèƒ½æŒ‰é’®ç»„ -->
    <view class="header-actions">
      <view class="action-btn" bindtap="toggleSearchOptions" hover-class="action-btn-hover">
        <text class="action-icon">âš™ï¸</text>
      </view>
      <view class="action-btn" bindtap="toggleFilters" hover-class="action-btn-hover">
        <text class="action-icon">{{showFilters ? 'ğŸ”¼' : 'ğŸ”½'}}</text>
      </view>
    </view>
  </view>

  <!-- æœç´¢å»ºè®®ä¸‹æ‹‰æ¡† -->
  <view wx:if="{{showSuggestions && searchSuggestions.length > 0}}" class="suggestions-dropdown">
    <view class="suggestions-header">
      <text class="suggestions-title">ğŸ’¡ æœç´¢å»ºè®®</text>
    </view>
    <view
      wx:for="{{searchSuggestions}}"
      wx:key="index"
      class="suggestion-item"
      bindtap="useSuggestion"
      data-suggestion="{{item}}"
    >
      <text class="suggestion-icon">{{item.icon}}</text>
      <text class="suggestion-text">{{item.text}}</text>
      <text class="suggestion-source">{{item.source}}</text>
    </view>
  </view>

  <!-- æœç´¢é€‰é¡¹é¢æ¿ -->
  <view wx:if="{{showOptions}}" class="search-options-panel">
    <view class="options-title">æœç´¢èŒƒå›´</view>
    <view class="options-list">
      <view class="option-item" bindtap="toggleSearchScope" data-scope="includeTools">
        <checkbox checked="{{searchOptions.includeTools}}" color="#1AAD19"/>
        <text>å·¥å…·</text>
      </view>
      <view class="option-item" bindtap="toggleSearchScope" data-scope="includeAbbreviations">
        <checkbox checked="{{searchOptions.includeAbbreviations}}" color="#1AAD19"/>
        <text>åŒ–å­¦ç¼©å†™</text>
      </view>
      <view class="option-item" bindtap="toggleSearchScope" data-scope="includeSemiconductors">
        <checkbox checked="{{searchOptions.includeSemiconductors}}" color="#1AAD19"/>
        <text>åŠå¯¼ä½“ææ–™</text>
      </view>
      <view class="option-item" bindtap="toggleSearchScope" data-scope="includeElements">
        <checkbox checked="{{searchOptions.includeElements}}" color="#1AAD19"/>
        <text>å…ƒç´ å‘¨æœŸè¡¨</text>
      </view>
    </view>
  </view>

  <!-- æœç´¢å†å²å’Œçƒ­é—¨æœç´¢ -->
  <view wx:if="{{showHistory}}" class="search-suggestions">
    <!-- æœç´¢å†å² -->
    <view wx:if="{{searchHistory.length > 0}}" class="suggestion-section">
      <view class="section-header">
        <text class="section-title">ğŸ• æœç´¢å†å²</text>
        <text class="clear-btn" bindtap="clearSearchHistory">æ¸…ç©º</text>
      </view>
      <view class="tag-list">
        <view
          wx:for="{{searchHistory}}"
          wx:key="*this"
          class="tag-item"
          bindtap="useHistorySearch"
          data-keyword="{{item}}"
        >
          {{item}}
        </view>
      </view>
    </view>

    <!-- çƒ­é—¨æœç´¢ -->
    <view class="suggestion-section">
      <view class="section-header">
        <text class="section-title">ğŸ”¥ çƒ­é—¨æœç´¢</text>
        <text class="section-subtitle">åŸºäºçœŸå®ç»Ÿè®¡</text>
      </view>
      <view class="hot-search-list">
        <view
          wx:for="{{hotSearches}}"
          wx:key="keyword"
          class="hot-search-tag rank-{{index + 1}}"
          bindtap="useHotSearch"
          data-keyword="{{item.keyword}}"
        >
          <text class="rank-number">{{index + 1}}</text>
          <text class="keyword-text">{{item.keyword}}</text>
          <text class="search-count">{{item.count}}æ¬¡</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢è¿‡æ»¤å™¨ -->
  <view wx:if="{{showFilters}}" class="search-filters">
    <view class="filter-group">
      <text class="filter-label">æ’åºæ–¹å¼</text>
      <view class="filter-options">
        <view 
          class="filter-option {{sortBy === 'relevance' ? 'active' : ''}}"
          bindtap="changeSortBy"
          data-sort="relevance"
        >
          ç›¸å…³åº¦
        </view>
        <view 
          class="filter-option {{sortBy === 'recent' ? 'active' : ''}}"
          bindtap="changeSortBy"
          data-sort="recent"
        >
          æœ€è¿‘æœç´¢
        </view>
        <view 
          class="filter-option {{sortBy === 'popular' ? 'active' : ''}}"
          bindtap="changeSortBy"
          data-sort="popular"
        >
          çƒ­é—¨
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{isSearching}}" class="loading-container">
    <icon type="waiting" size="40" color="#1AAD19"></icon>
    <text class="loading-text">æœç´¢ä¸­...</text>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view wx:if="{{!isSearching && !showHistory}}" class="search-results">
    <!-- ç»“æœæ“ä½œæ  -->
    <view wx:if="{{!noResults && searchResults.length > 0}}" class="result-actions-bar">
      <view class="result-info">
        <text class="result-total">å…± {{searchResults.length}} æ¡ç»“æœ</text>
        <text wx:if="{{fromCache}}" class="cache-badge">âš¡ ç¼“å­˜</text>
      </view>
      <view class="result-actions">
        <view class="action-btn-small" bindtap="exportResults">
          <text class="btn-icon-small">ğŸ“¤</text>
          <text class="btn-text-small">å¯¼å‡º</text>
        </view>
      </view>
    </view>

    <!-- æ— ç»“æœ -->
    <view wx:if="{{noResults}}" class="no-results">
      <icon type="search" size="60" color="#ccc"></icon>
      <text class="no-results-text">æœªæ‰¾åˆ° "{{searchKeyword}}" ç›¸å…³ç»“æœ</text>
      <text class="no-results-hint">è¯•è¯•å…¶ä»–å…³é”®è¯</text>
      <view class="search-suggestions-text">
        <text class="suggestion-title">ğŸ’¡ æœç´¢å»ºè®®ï¼š</text>
        <text class="suggestion-item">â€¢ å·¥å…·ï¼šXRDã€pHã€å•ä½æ¢ç®—</text>
        <text class="suggestion-item">â€¢ ç¼©å†™ï¼šDMFã€DMSOã€THF</text>
        <text class="suggestion-item">â€¢ åŠå¯¼ä½“ï¼šTiO2ã€GaNã€Si</text>
        <text class="suggestion-item">â€¢ å…ƒç´ ï¼šæ°§ã€é“ã€ç¢³ã€é‡‘</text>
        <text class="suggestion-item">â€¢ å…‰è°±ï¼šXPSã€Ramanã€IR</text>
        <text class="suggestion-item">â€¢ Kspï¼šAgClã€BaSO4</text>
        <text class="suggestion-item">â€¢ ç”µæï¼šSCEã€SHE</text>
        <text class="suggestion-item">â€¢ Xå°„çº¿æºï¼šCuKaã€MoKa</text>
      </view>
    </view>

    <!-- æœ‰ç»“æœ -->
    <view wx:else>
      <!-- å·¥å…·ç»“æœ -->
      <view wx:if="{{allResultsByType.tools && allResultsByType.tools.length > 0}}" class="result-section">
        <view class="result-header">
          <text class="result-title">ğŸ› ï¸ å·¥å…·</text>
          <text class="result-count">{{resultsByType.tools.length}}/{{allResultsByType.tools.length}}</text>
        </view>
        <view
          wx:for="{{resultsByType.tools}}"
          wx:key="name"
          class="result-item"
          bindtap="handleResultTap"
          data-item="{{item}}"
        >
          <view class="result-name">{{item.name}}</view>
          <view class="result-type">{{item.type}}</view>
        </view>
        <view wx:if="{{hasMoreByType.tools}}" class="load-more-results" bindtap="loadMoreResults" data-type="tools">
          <text class="load-more-text">åŠ è½½æ›´å¤š (è¿˜æœ‰ {{allResultsByType.tools.length - resultsByType.tools.length}} æ¡)</text>
        </view>
      </view>

      <!-- ç¼©å†™ç»“æœ -->
      <view wx:if="{{allResultsByType.abbreviations && allResultsByType.abbreviations.length > 0}}" class="result-section">
        <view class="result-header">
          <text class="result-title">ğŸ“– åŒ–å­¦ç¼©å†™</text>
          <text class="result-count">{{resultsByType.abbreviations.length}}/{{allResultsByType.abbreviations.length}}</text>
        </view>
        <view
          wx:for="{{resultsByType.abbreviations}}"
          wx:key="name"
          class="result-item"
          bindtap="handleResultTap"
          data-item="{{item}}"
        >
          <view class="result-name">{{item.name}}</view>
          <view class="result-desc">{{item.fullName}} - {{item.chineseName}}</view>
        </view>
        <view wx:if="{{hasMoreByType.abbreviations}}" class="load-more-results" bindtap="loadMoreResults" data-type="abbreviations">
          <text class="load-more-text">åŠ è½½æ›´å¤š (è¿˜æœ‰ {{allResultsByType.abbreviations.length - resultsByType.abbreviations.length}} æ¡)</text>
        </view>
      </view>

      <!-- åŠå¯¼ä½“ç»“æœ -->
      <view wx:if="{{allResultsByType.semiconductors && allResultsByType.semiconductors.length > 0}}" class="result-section">
        <view class="result-header">
          <text class="result-title">ğŸ’ åŠå¯¼ä½“ææ–™</text>
          <text class="result-count">{{resultsByType.semiconductors.length}}/{{allResultsByType.semiconductors.length}}</text>
        </view>
        <view
          wx:for="{{resultsByType.semiconductors}}"
          wx:key="formula"
          class="result-item"
          bindtap="handleResultTap"
          data-item="{{item}}"
        >
          <view class="result-name">{{item.name}} ({{item.formula}})</view>
          <view class="result-desc">å¸¦éš™: {{item.bandgap}} eV</view>
        </view>
        <view wx:if="{{hasMoreByType.semiconductors}}" class="load-more-results" bindtap="loadMoreResults" data-type="semiconductors">
          <text class="load-more-text">åŠ è½½æ›´å¤š (è¿˜æœ‰ {{allResultsByType.semiconductors.length - resultsByType.semiconductors.length}} æ¡)</text>
        </view>
      </view>

      <!-- å…ƒç´ ç»“æœ -->
      <view wx:if="{{allResultsByType.elements && allResultsByType.elements.length > 0}}" class="result-section">
        <view class="result-header">
          <text class="result-title">âš›ï¸ å…ƒç´ </text>
          <text class="result-count">{{resultsByType.elements.length}}/{{allResultsByType.elements.length}}</text>
        </view>
        <view
          wx:for="{{resultsByType.elements}}"
          wx:key="symbol"
          class="result-item"
          bindtap="handleResultTap"
          data-item="{{item}}"
        >
          <view class="result-name">{{item.name}} ({{item.symbol}})</view>
          <view class="result-desc">åŸå­åºæ•°: {{item.number}}</view>
        </view>
        <view wx:if="{{hasMoreByType.elements}}" class="load-more-results" bindtap="loadMoreResults" data-type="elements">
          <text class="load-more-text">åŠ è½½æ›´å¤š (è¿˜æœ‰ {{allResultsByType.elements.length - resultsByType.elements.length}} æ¡)</text>
        </view>
      </view>

      <!-- å…‰è°±æ•°æ®ç»“æœ -->
      <view wx:if="{{allResultsByType.spectroscopy && allResultsByType.spectroscopy.length > 0}}" class="result-section">
        <view class="result-header">
          <text class="result-title">ğŸ“Š å…‰è°±æ•°æ®</text>
          <text class="result-count">{{resultsByType.spectroscopy.length}}/{{allResultsByType.spectroscopy.length}}</text>
        </view>
        <view
          wx:for="{{resultsByType.spectroscopy}}"
          wx:key="name"
          class="result-item"
          bindtap="handleResultTap"
          data-item="{{item}}"
        >
          <view class="result-name">{{item.name}}</view>
          <view class="result-desc">{{item.description}}</view>
        </view>
        <view wx:if="{{hasMoreByType.spectroscopy}}" class="load-more-results" bindtap="loadMoreResults" data-type="spectroscopy">
          <text class="load-more-text">åŠ è½½æ›´å¤š (è¿˜æœ‰ {{allResultsByType.spectroscopy.length - resultsByType.spectroscopy.length}} æ¡)</text>
        </view>
      </view>

      <!-- Kspæ•°æ®ç»“æœ -->
      <view wx:if="{{allResultsByType.ksp && allResultsByType.ksp.length > 0}}" class="result-section">
        <view class="result-header">
          <text class="result-title">âš—ï¸ éš¾æº¶ç›</text>
          <text class="result-count">{{resultsByType.ksp.length}}/{{allResultsByType.ksp.length}}</text>
        </view>
        <view
          wx:for="{{resultsByType.ksp}}"
          wx:key="name"
          class="result-item"
          bindtap="handleResultTap"
          data-item="{{item}}"
        >
          <view class="result-name">{{item.name}} - {{item.chineseName}}</view>
          <view class="result-desc">Ksp = {{item.ksp}}</view>
        </view>
        <view wx:if="{{hasMoreByType.ksp}}" class="load-more-results" bindtap="loadMoreResults" data-type="ksp">
          <text class="load-more-text">åŠ è½½æ›´å¤š (è¿˜æœ‰ {{allResultsByType.ksp.length - resultsByType.ksp.length}} æ¡)</text>
        </view>
      </view>

      <!-- å‚æ¯”ç”µæç»“æœ -->
      <view wx:if="{{allResultsByType.references && allResultsByType.references.length > 0}}" class="result-section">
        <view class="result-header">
          <text class="result-title">ğŸ”‹ å‚æ¯”ç”µæ</text>
          <text class="result-count">{{resultsByType.references.length}}/{{allResultsByType.references.length}}</text>
        </view>
        <view
          wx:for="{{resultsByType.references}}"
          wx:key="name"
          class="result-item"
          bindtap="handleResultTap"
          data-item="{{item}}"
        >
          <view class="result-name">{{item.name}} - {{item.chineseName}}</view>
          <view class="result-desc">E = {{item.potential}}</view>
        </view>
        <view wx:if="{{hasMoreByType.references}}" class="load-more-results" bindtap="loadMoreResults" data-type="references">
          <text class="load-more-text">åŠ è½½æ›´å¤š (è¿˜æœ‰ {{allResultsByType.references.length - resultsByType.references.length}} æ¡)</text>
        </view>
      </view>

      <!-- Xå°„çº¿æºç»“æœ -->
      <view wx:if="{{allResultsByType.xrays && allResultsByType.xrays.length > 0}}" class="result-section">
        <view class="result-header">
          <text class="result-title">ğŸ“¡ Xå°„çº¿æº</text>
          <text class="result-count">{{resultsByType.xrays.length}}/{{allResultsByType.xrays.length}}</text>
        </view>
        <view
          wx:for="{{resultsByType.xrays}}"
          wx:key="name"
          class="result-item"
          bindtap="handleResultTap"
          data-item="{{item}}"
        >
          <view class="result-name">{{item.name}}</view>
          <view class="result-desc">Î» = {{item.wavelength}}, E = {{item.energy}}</view>
        </view>
        <view wx:if="{{hasMoreByType.xrays}}" class="load-more-results" bindtap="loadMoreResults" data-type="xrays">
          <text class="load-more-text">åŠ è½½æ›´å¤š (è¿˜æœ‰ {{allResultsByType.xrays.length - resultsByType.xrays.length}} æ¡)</text>
        </view>
      </view>
    </view>
  </view>
</view>

