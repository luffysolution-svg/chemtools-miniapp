<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">ğŸ§ª åŒ–å­¦å“å®‰å…¨é€ŸæŸ¥</text>
    <text class="page-subtitle">GHSå…¨çƒåŒ–å­¦å“ç»Ÿä¸€åˆ†ç±»æ ‡å‡†</text>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-section">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        type="text" 
        value="{{searchQuery}}"
        placeholder="æœç´¢åŒ–å­¦å“åç§°ã€CASå·ã€åˆ†å­å¼"
        bindinput="handleSearchInput"
        bindconfirm="handleSearch"
      />
      <text wx:if="{{searchQuery}}" class="clear-icon" bindtap="clearSearch">âœ•</text>
    </view>
  </view>

  <!-- å¿«é€Ÿç­›é€‰ -->
  <view class="filter-section">
    <scroll-view class="filter-scroll" scroll-x>
      <view class="filter-tabs">
        <view 
          class="filter-tab {{filterType === 'all' ? 'active' : ''}}"
          data-type="all"
          bindtap="switchFilter"
        >
          <text>å…¨éƒ¨</text>
          <text class="filter-count">{{allChemicals.length}}</text>
        </view>
        <view 
          class="filter-tab {{filterType === 'high' ? 'active danger' : ''}}"
          data-type="high"
          bindtap="switchFilter"
        >
          <text>âš ï¸ é«˜å±</text>
        </view>
        <view 
          class="filter-tab {{filterType === 'medium' ? 'active warning' : ''}}"
          data-type="medium"
          bindtap="switchFilter"
        >
          <text>âš¡ ä¸­å±</text>
        </view>
        <view 
          class="filter-tab {{filterType === 'low' ? 'active safe' : ''}}"
          data-type="low"
          bindtap="switchFilter"
        >
          <text>âœ“ ä½å±</text>
        </view>
        <view 
          class="filter-tab {{filterType === 'acid' ? 'active' : ''}}"
          data-type="acid"
          bindtap="switchFilter"
        >
          <text>é…¸ç±»</text>
        </view>
        <view 
          class="filter-tab {{filterType === 'base' ? 'active' : ''}}"
          data-type="base"
          bindtap="switchFilter"
        >
          <text>ç¢±ç±»</text>
        </view>
        <view 
          class="filter-tab {{filterType === 'solvent' ? 'active' : ''}}"
          data-type="solvent"
          bindtap="switchFilter"
        >
          <text>æœ‰æœºæº¶å‰‚</text>
        </view>
        <view 
          class="filter-tab {{filterType === 'oxidizer' ? 'active' : ''}}"
          data-type="oxidizer"
          bindtap="switchFilter"
        >
          <text>æ°§åŒ–å‰‚</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ç»“æœç»Ÿè®¡ -->
  <view class="result-header">
    <text class="result-text">æ‰¾åˆ° {{filteredChemicals.length}} ç§åŒ–å­¦å“</text>
    <view class="sort-options">
      <text class="sort-btn {{sortBy === 'name' ? 'active' : ''}}" data-sort="name" bindtap="changeSort">åç§°</text>
      <text class="sort-divider">|</text>
      <text class="sort-btn {{sortBy === 'danger' ? 'active' : ''}}" data-sort="danger" bindtap="changeSort">å±é™©åº¦</text>
    </view>
  </view>

  <!-- åŒ–å­¦å“åˆ—è¡¨ -->
  <view class="chemical-list">
    <view 
      wx:for="{{filteredChemicals}}" 
      wx:key="cas"
      class="chemical-card"
      data-cas="{{item.cas}}"
      bindtap="selectChemical"
    >
      <view class="card-header">
        <view class="chemical-names">
          <text class="chemical-name">{{item.name}}</text>
          <text class="chemical-formula">{{item.formula}}</text>
        </view>
        <view class="hazard-badge {{item.hazardLevel}}">
          <text wx:if="{{item.hazardLevel === 'high'}}">âš ï¸ é«˜å±</text>
          <text wx:elif="{{item.hazardLevel === 'medium'}}">âš¡ ä¸­å±</text>
          <text wx:else>âœ“ ä½å±</text>
        </view>
      </view>
      
      <view class="card-content">
        <text class="chemical-en">{{item.nameEn}}</text>
        <view class="chemical-meta">
          <text class="meta-item">ğŸ“‹ CAS: {{item.cas}}</text>
        </view>
      </view>

      <view class="card-footer">
        <text class="view-detail">æŸ¥çœ‹è¯¦æƒ… â†’</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{filteredChemicals.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ”</text>
      <text class="empty-text">æœªæ‰¾åˆ°ç›¸å…³åŒ–å­¦å“</text>
      <text class="empty-hint">è¯•è¯•æœç´¢å…¶ä»–å…³é”®è¯</text>
    </view>
  </view>

  <!-- è¯¦æƒ…å¼¹çª— -->
  <view wx:if="{{showDetail}}" class="detail-modal" bindtap="closeDetail">
    <view class="detail-container" catchtap="doNothing">
      <!-- è¯¦æƒ…å¤´éƒ¨ -->
      <view class="detail-header {{selectedChemical.hazardLevel}}">
        <view class="detail-close" bindtap="closeDetail">âœ•</view>
        <text class="detail-title">{{selectedChemical.name}}</text>
        <text class="detail-subtitle">{{selectedChemical.nameEn}}</text>
        <view class="detail-basic">
          <view class="basic-item">
            <text class="basic-label">CAS</text>
            <text class="basic-value">{{selectedChemical.cas}}</text>
          </view>
          <view class="basic-item">
            <text class="basic-label">åˆ†å­å¼</text>
            <text class="basic-value">{{selectedChemical.formula}}</text>
          </view>
        </view>
      </view>

      <!-- è¯¦æƒ…å†…å®¹ -->
      <scroll-view class="detail-scroll" scroll-y>
        <!-- GHSå±é™©æ€§ -->
        <view class="detail-section danger-section">
          <view class="section-header">
            <text class="section-icon">âš ï¸</text>
            <text class="section-title">GHSå±é™©æ€§åˆ†ç±»</text>
          </view>
          <view class="hazard-codes">
            <text wx:for="{{selectedChemical.ghsHazards}}" wx:key="*this" class="hazard-code">{{item}}</text>
          </view>
          <view class="hazard-list">
            <view wx:for="{{selectedChemical.hazardStatements}}" wx:key="*this" class="hazard-item">
              <text class="hazard-dot">â—</text>
              <text class="hazard-text">{{item}}</text>
            </view>
          </view>
        </view>

        <!-- é˜²æŠ¤æªæ–½ -->
        <view class="detail-section">
          <view class="section-header">
            <text class="section-icon">ğŸ›¡ï¸</text>
            <text class="section-title">é˜²æŠ¤æªæ–½</text>
          </view>
          <view class="precaution-list">
            <view wx:for="{{selectedChemical.precautions}}" wx:key="*this" class="precaution-item">
              <text class="precaution-number">{{index + 1}}</text>
              <text class="precaution-text">{{item}}</text>
            </view>
          </view>
        </view>

        <!-- ä¸ç›¸å®¹ç‰©è´¨ -->
        <view class="detail-section">
          <view class="section-header">
            <text class="section-icon">ğŸš«</text>
            <text class="section-title">ä¸ç›¸å®¹ç‰©è´¨</text>
          </view>
          <view class="incompatible-tags">
            <text wx:for="{{selectedChemical.incompatible}}" wx:key="*this" class="incompatible-tag">{{item}}</text>
          </view>
        </view>

        <!-- å‚¨å­˜æ¡ä»¶ -->
        <view class="detail-section">
          <view class="section-header">
            <text class="section-icon">ğŸ“¦</text>
            <text class="section-title">å‚¨å­˜æ¡ä»¶</text>
          </view>
          <text class="storage-text">{{selectedChemical.storage}}</text>
        </view>

        <!-- æ€¥æ•‘æªæ–½ -->
        <view class="detail-section emergency-section">
          <view class="section-header">
            <text class="section-icon">ğŸš‘</text>
            <text class="section-title">æ€¥æ•‘æªæ–½</text>
          </view>
          <view class="first-aid-grid">
            <view class="aid-card">
              <text class="aid-icon">ğŸ‘‹</text>
              <text class="aid-label">çš®è‚¤æ¥è§¦</text>
              <text class="aid-content">{{selectedChemical.firstAid.skin}}</text>
            </view>
            <view class="aid-card">
              <text class="aid-icon">ğŸ‘ï¸</text>
              <text class="aid-label">çœ¼ç›æ¥è§¦</text>
              <text class="aid-content">{{selectedChemical.firstAid.eyes}}</text>
            </view>
            <view class="aid-card">
              <text class="aid-icon">ğŸ‘ƒ</text>
              <text class="aid-label">å¸å…¥</text>
              <text class="aid-content">{{selectedChemical.firstAid.inhalation}}</text>
            </view>
            <view class="aid-card">
              <text class="aid-icon">ğŸ‘„</text>
              <text class="aid-label">é£Ÿå…¥</text>
              <text class="aid-content">{{selectedChemical.firstAid.ingestion}}</text>
            </view>
          </view>
        </view>

        <!-- ç‰¹åˆ«æç¤º -->
        <view wx:if="{{selectedChemical.notes}}" class="detail-section note-section">
          <view class="section-header">
            <text class="section-icon">ğŸ’¡</text>
            <text class="section-title">ç‰¹åˆ«æç¤º</text>
          </view>
          <view class="note-box">
            <text class="note-text">{{selectedChemical.notes}}</text>
          </view>
        </view>
      </scroll-view>

      <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
      <view class="detail-actions">
        <button class="action-btn export-btn" bindtap="exportSafety">
          <text class="btn-icon">ğŸ“¤</text>
          <text>å¯¼å‡º</text>
        </button>
        <button class="action-btn share-btn" bindtap="shareSafety">
          <text class="btn-icon">ğŸ“‹</text>
          <text>åˆ†äº«</text>
        </button>
      </view>
    </view>
  </view>
</view>
