<view class="semiconductor-page">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="header-icon">ğŸ’¡</text>
    <view class="header-content">
      <view class="header-title">åŠå¯¼ä½“æ•°æ®åº“</view>
      <view class="header-desc">æŸ¥è¯¢åŠå¯¼ä½“ææ–™çš„å¸¦éš™ã€èƒ½å¸¦ä½ç½®ç­‰å…³é”®å‚æ•°</view>
    </view>
  </view>

  <!-- æœç´¢ä¸ç­›é€‰ -->
  <view class="section-card">
    <view class="search-box">
      <input 
        class="search-input" 
        type="text"
        value="{{searchKeyword}}"
        placeholder="æœç´¢ææ–™åç§°/åŒ–å­¦å¼"
        bindinput="handleSearchInput"
      />
      <button wx:if="{{searchKeyword}}" class="clear-btn" bindtap="clearSearch">âœ•</button>
    </view>

    <!-- å¸¦éš™ç­›é€‰ -->
    <view class="filter-section">
      <view class="filter-title">æŒ‰å¸¦éš™èŒƒå›´ç­›é€‰ï¼š</view>
      <scroll-view class="filter-tags" scroll-x="{{true}}">
        <view 
          wx:for="{{bandgapRanges}}" 
          wx:key="label"
          class="filter-tag {{selectedBandgapRange === item.label ? 'active' : ''}}"
          data-label="{{item.label}}"
          bindtap="selectBandgapRange"
        >
          {{item.label}}
        </view>
      </scroll-view>
    </view>

    <!-- å¿«é€Ÿé€‰æ‹© -->
    <view class="quick-select">
      <view class="quick-title">å¸¸ç”¨ææ–™ï¼š</view>
      <view class="quick-tags">
        <view 
          wx:for="{{quickSelectMaterials}}" 
          wx:key="*this"
          class="quick-tag"
          bindtap="quickSelectMaterial"
          data-name="{{item}}"
        >
          {{item}}
        </view>
      </view>
    </view>
  </view>

  <!-- ææ–™ç½‘æ ¼ -->
  <view class="section-card">
    <view class="section-title-row">
      <text class="section-title">åŠå¯¼ä½“ææ–™ {{loading ? '' : '(' + filteredMaterials.length + ')'}}</text>
      <text class="section-hint">ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</text>
    </view>
    
    <!-- éª¨æ¶å± -->
    <view wx:if="{{loading}}" class="material-grid">
      <skeleton type="tool" rows="6"></skeleton>
    </view>
    
    <!-- å®é™…å†…å®¹ -->
    <view wx:else class="material-grid">
      <view 
        wx:for="{{filteredMaterials}}" 
        wx:key="name"
        class="material-card"
        data-material="{{item}}"
        bindtap="showMaterialDetail"
      >
        <view class="card-header">
          <view class="card-name">{{item.name}}</view>
          <view class="card-formula">{{item.formula}}</view>
        </view>
        <view class="card-body">
          <view class="bandgap-badge">
            <text class="bandgap-value">{{item.bandGap.value}} eV</text>
            <text class="bandgap-type">{{item.bandGap.type === 'direct' ? 'ç›´æ¥' : 'é—´æ¥'}}</text>
          </view>
        </view>
      </view>
      
      <view wx:if="{{filteredMaterials.length === 0}}" class="empty-hint">
        æœªæ‰¾åˆ°åŒ¹é…çš„ææ–™
      </view>
    </view>
  </view>

  <!-- ææ–™è¯¦æƒ…å¼¹çª— -->
  <view wx:if="{{selectedMaterial}}" class="modal-overlay" bindtap="closeDetail">
    <view 
      class="modal-content" 
      style="transform: translateY({{modalTranslate}}px); opacity: {{1 - modalTranslate / 500}};"
      catchtap="preventClose"
      bindtouchstart="handleTouchStart"
      bindtouchmove="handleTouchMove"
      bindtouchend="handleTouchEnd"
    >
      <!-- ä¸‹æ»‘æŒ‡ç¤ºå™¨ -->
      <view class="modal-drag-indicator"></view>
      <view class="modal-header">
        <view class="material-preview">
          <view class="preview-name">{{selectedMaterial.name}}</view>
          <view class="preview-formula">{{selectedMaterial.formula}}</view>
        </view>
        <button class="close-btn" bindtap="closeDetail">âœ•</button>
      </view>

      <scroll-view class="modal-body" scroll-y="{{true}}">
        <!-- å¸¦éš™ä¿¡æ¯ -->
        <view class="detail-section highlight">
          <view class="detail-title">å¸¦éš™ä¿¡æ¯</view>
          <view class="bandgap-display">
            <view class="bandgap-value">Eg = {{selectedMaterial.bandGap.value}} eV</view>
            <view class="bandgap-type">{{selectedMaterial.bandGap.type === 'direct' ? 'ç›´æ¥å¸¦éš™' : 'é—´æ¥å¸¦éš™'}}</view>
            <view class="bandgap-temp" wx:if="{{selectedMaterial.bandGap.temperature}}">
              æµ‹è¯•æ¸©åº¦ï¼š{{selectedMaterial.bandGap.temperature}}
            </view>
          </view>
        </view>

        <!-- èƒ½å¸¦ä½ç½® -->
        <view class="detail-section">
          <view class="detail-title">èƒ½å¸¦ä½ç½® (vs NHE, pH=0)</view>
          <view class="band-diagram">
            <view class="band-item">
              <text class="band-label">å¯¼å¸¦åº• (CB)</text>
              <text class="band-value">{{selectedMaterial.conductionBand}} eV</text>
            </view>
            <view class="band-item">
              <text class="band-label">ä»·å¸¦é¡¶ (VB)</text>
              <text class="band-value">{{selectedMaterial.valenceBand}} eV</text>
            </view>
          </view>
        </view>

        <!-- ç‰©ç†æ€§è´¨ -->
        <view class="detail-section">
          <view class="detail-title">ç‰©ç†ä¸åŒ–å­¦æ€§è´¨</view>
          <view class="property-list">
            <view class="property-item">
              <text class="prop-label">æ™¶ä½“ç»“æ„</text>
              <text class="prop-value">{{selectedMaterial.crystalStructure || 'â€”'}}</text>
            </view>
            <view class="property-item">
              <text class="prop-label">ç”µå­è¿ç§»ç‡</text>
              <text class="prop-value">{{selectedMaterial.electronMobility || 'â€”'}}</text>
            </view>
            <view class="property-item">
              <text class="prop-label">ç©ºç©´è¿ç§»ç‡</text>
              <text class="prop-value">{{selectedMaterial.holeMobility || 'â€”'}}</text>
            </view>
            <view class="property-item" wx:if="{{selectedMaterial.casNumber}}">
              <text class="prop-label">CASå·</text>
              <text class="prop-value">{{selectedMaterial.casNumber}}</text>
            </view>
            <view class="property-item" wx:if="{{selectedMaterial.molecularWeight}}">
              <text class="prop-label">åˆ†å­é‡</text>
              <text class="prop-value">{{selectedMaterial.molecularWeight}} g/mol</text>
            </view>
          </view>
        </view>

        <!-- åº”ç”¨ -->
        <view class="detail-section" wx:if="{{selectedMaterial.applications}}">
          <view class="detail-title">åº”ç”¨é¢†åŸŸ</view>
          <view class="applications">{{selectedMaterial.applications}}</view>
        </view>

        <!-- åˆ«å -->
        <view class="detail-section" wx:if="{{selectedMaterial.aliases && selectedMaterial.aliases.length}}">
          <view class="detail-title">åˆ«å</view>
          <view class="aliases">{{selectedMaterial.aliases.join('ã€')}}</view>
        </view>
      </scroll-view>

      <view class="modal-footer">
        <button class="btn-secondary" bindtap="copyMaterialInfo">å¤åˆ¶ä¿¡æ¯</button>
        <button class="btn-primary" bindtap="closeDetail">å…³é—­</button>
      </view>
    </view>
  </view>
</view>

