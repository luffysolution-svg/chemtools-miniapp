<wxs module="helper" src="./helper.wxs"></wxs>

<view class="semiconductor-page">
  <!-- 页面头部 -->
  <view class="page-header">
    <text class="header-icon">💡</text>
    <view class="header-content">
      <view class="header-title">半导体数据库 v8.0</view>
      <view class="header-desc">{{totalCount}}种材料 · 新增{{newCount}}种前沿材料（钙钛矿、2D、量子点）</view>
    </view>
  </view>

  <!-- 学术风格搜索与筛选 -->
  <view class="section-card">
    <search-input
      value="{{searchKeyword}}"
      placeholder="搜索半导体材料名称或化学式"
      enableHistory="{{true}}"
      historyKey="semiconductor"
      hotSearches="{{hotMaterials}}"
      showHot="{{!searchKeyword}}"
      bindinput="handleSearchInput"
      bindsearch="handleSearch"
      bindclear="clearSearch"
    />

    <!-- 学术风格分类筛选 -->
    <quick-filter
      title="材料类别"
      filters="{{categoryFilterOptions}}"
      selected="{{categoryFilter}}"
      mode="single"
      showCount="{{false}}"
      showClear="{{true}}"
      bindchange="handleCategoryFilterChange"
      bind:clear="clearCategoryFilter"
    />

    <!-- 学术风格带隙筛选 -->
    <quick-filter
      title="带隙范围"
      filters="{{bandgapFilterOptions}}"
      selected="{{selectedBandgapRange}}"
      mode="single"
      showCount="{{false}}"
      showClear="{{true}}"
      bindchange="handleBandgapFilterChange"
      bind:clear="clearBandgapFilter"
    />
  </view>

  <!-- 材料网格 -->
  <view class="section-card">
    <view class="section-title-row">
      <text class="section-title">半导体材料 {{loading ? '' : '(' + filteredMaterials.length + ')'}}</text>
      <text class="section-hint">点击查看详情</text>
    </view>
    
    <!-- 骨架屏 -->
    <view wx:if="{{loading}}" class="material-grid">
      <skeleton type="tool" rows="6"></skeleton>
    </view>
    
    <!-- 实际内容 -->
    <view wx:else class="material-grid">
      <view 
        wx:for="{{filteredMaterials}}" 
        wx:key="name"
        class="material-card"
        data-material="{{item}}"
        bindtap="showMaterialDetail"
      >
        <view class="card-header">
          <view class="card-name">{{item.name}}</view>
          <view class="card-formula">{{item.formula}}</view>
        </view>
        <view class="card-body">
          <view class="bandgap-badge">
            <text class="bandgap-value">{{helper.getBandGapValue(item)}} eV</text>
            <text class="bandgap-type">{{helper.getBandGapTypeName(item)}}</text>
          </view>
        </view>
      </view>
      
      <view wx:if="{{filteredMaterials.length === 0}}" class="empty-hint">
        未找到匹配的材料
      </view>
    </view>
  </view>

  <!-- 材料详情弹窗 -->
  <view wx:if="{{selectedMaterial}}" class="modal-overlay" bindtap="closeDetail">
    <view 
      class="modal-content" 
      style="transform: translateY({{modalTranslate}}px); opacity: {{1 - modalTranslate / 500}};"
      catchtap="preventClose"
      bindtouchstart="handleTouchStart"
      bindtouchmove="handleTouchMove"
      bindtouchend="handleTouchEnd"
    >
      <!-- 下滑指示器 -->
      <view class="modal-drag-indicator"></view>
      <view class="modal-header">
        <view class="material-preview">
          <view class="preview-name">{{selectedMaterial.name}}</view>
          <view class="preview-formula">{{selectedMaterial.formula}}</view>
        </view>
        <button class="close-btn" bindtap="closeDetail">✕</button>
      </view>

      <scroll-view class="modal-body" scroll-y="{{true}}">
        <!-- 带隙信息 -->
        <view class="detail-section highlight">
          <view class="detail-title">带隙信息</view>
          <view class="bandgap-display">
            <view class="bandgap-value">Eg = {{helper.getBandGapValue(selectedMaterial)}} eV</view>
            <view class="bandgap-type">{{helper.getBandGapType(selectedMaterial) === 'direct' ? '直接带隙' : '间接带隙'}}</view>
            <view class="bandgap-temp" wx:if="{{selectedMaterial.bandGap && selectedMaterial.bandGap.temperature}}">
              测试温度：{{selectedMaterial.bandGap.temperature}}
            </view>
          </view>
        </view>

        <!-- 能带位置 -->
        <view class="detail-section">
          <view class="detail-title">能带位置 (vs NHE, pH=0)</view>
          <view class="band-diagram">
            <view class="band-item">
              <text class="band-label">导带底 (CB)</text>
              <text class="band-value">{{selectedMaterial.conductionBand}} eV</text>
            </view>
            <view class="band-item">
              <text class="band-label">价带顶 (VB)</text>
              <text class="band-value">{{selectedMaterial.valenceBand}} eV</text>
            </view>
          </view>
        </view>

        <!-- 物理性质 -->
        <view class="detail-section">
          <view class="detail-title">物理与化学性质</view>
          <view class="property-list">
            <view class="property-item">
              <text class="prop-label">晶体结构</text>
              <text class="prop-value">{{selectedMaterial.crystalStructure || '—'}}</text>
            </view>
            <view class="property-item">
              <text class="prop-label">电子迁移率</text>
              <text class="prop-value">{{selectedMaterial.electronMobility || '—'}}</text>
            </view>
            <view class="property-item">
              <text class="prop-label">空穴迁移率</text>
              <text class="prop-value">{{selectedMaterial.holeMobility || '—'}}</text>
            </view>
            <view class="property-item" wx:if="{{selectedMaterial.casNumber}}">
              <text class="prop-label">CAS号</text>
              <text class="prop-value">{{selectedMaterial.casNumber}}</text>
            </view>
            <view class="property-item" wx:if="{{selectedMaterial.molecularWeight}}">
              <text class="prop-label">分子量</text>
              <text class="prop-value">{{selectedMaterial.molecularWeight}} g/mol</text>
            </view>
          </view>
        </view>

        <!-- 应用 -->
        <view class="detail-section" wx:if="{{selectedMaterial.applications}}">
          <view class="detail-title">应用领域</view>
          <view class="applications">{{selectedMaterial.applications}}</view>
        </view>

        <!-- 别名 -->
        <view class="detail-section" wx:if="{{selectedMaterial.aliases && selectedMaterial.aliases.length}}">
          <view class="detail-title">别名</view>
          <view class="aliases">{{selectedMaterial.aliases.join('、')}}</view>
        </view>
      </scroll-view>

      <view class="modal-footer">
        <button class="btn-secondary" bindtap="copyMaterialInfo">复制信息</button>
        <button class="btn-primary" bindtap="closeDetail">关闭</button>
      </view>
    </view>
  </view>
</view>

