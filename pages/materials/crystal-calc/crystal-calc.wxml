<view class="container">
  <!-- å·¥å…·é€‰æ‹© Tab -->
  <view class="tool-tabs">
    <view 
      wx:for="{{tools}}" 
      wx:key="id"
      class="tab-item {{currentTool === item.id ? 'active' : ''}}"
      data-tool="{{item.id}}"
      bindtap="switchTool"
    >
      <text class="tab-icon">{{item.icon}}</text>
      <text class="tab-name">{{item.name}}</text>
    </view>
  </view>

  <!-- ç†è®ºå¯†åº¦è®¡ç®— -->
  <view wx:if="{{currentTool === 'density'}}" class="tool-content">
    <view class="tool-intro">
      <text class="intro-title">âš–ï¸ ç†è®ºå¯†åº¦è®¡ç®—</text>
      <text class="intro-desc">ä»æ™¶ä½“ç»“æ„è®¡ç®—ææ–™ç†è®ºå¯†åº¦</text>
      <text class="intro-formula">Ï = (Z Ã— M) / (N_A Ã— V)</text>
    </view>

    <view class="input-section">
      <calculator-input
        label="åŒ–å­¦å¼"
        value="{{formula}}"
        type="text"
        placeholder="ä¾‹å¦‚ï¼šTiO2"
        icon="ğŸ§¬"
        bind:input="handleFormulaInput"
      />

      <calculator-input
        label="Zå€¼"
        value="{{zValue}}"
        type="number"
        placeholder="ä¾‹å¦‚ï¼š4"
        icon="ğŸ”¢"
        hint="æ¯ä¸ªæ™¶èƒä¸­çš„åˆ†å­æ•°"
        bind:input="handleZValueInput"
      />

      <view class="picker-field">
        <text class="picker-label">æ™¶ç³»</text>
        <picker mode="selector" range="{{crystalSystems}}" value="{{crystalIndex}}" bindchange="handleCrystalSystemChange">
          <view class="picker-value">{{crystalSystems[crystalIndex]}}</view>
        </picker>
      </view>

      <calculator-input
        label="æ™¶æ ¼å‚æ•° a"
        value="{{latticeA}}"
        type="digit"
        placeholder="ä¾‹å¦‚ï¼š4.593"
        unit="Ã…"
        icon="ğŸ“"
        enableHistory="{{true}}"
        historyTool="crystal"
        historyField="latticeParameter"
        presets="{{latticePresets}}"
        touchArea="large"
        bind:input="handleLatticeAInput"
        bindchange="handleLatticeAChange"
      />

      <calculator-input
        wx:if="{{crystalIndex >= 2}}"
        label="æ™¶æ ¼å‚æ•° b"
        value="{{latticeB}}"
        type="digit"
        placeholder="åŒa"
        unit="Ã…"
        icon="ğŸ“"
        hint="æ­£äº¤/å•æ–œ/ä¸‰æ–œæ™¶ç³»éœ€è¦"
        bind:input="handleLatticeBInput"
      />

      <calculator-input
        wx:if="{{crystalIndex >= 1}}"
        label="æ™¶æ ¼å‚æ•° c"
        value="{{latticeC}}"
        type="digit"
        placeholder="åŒa"
        unit="Ã…"
        icon="ğŸ“"
        hint="å››æ–¹åŠä»¥ä¸Šæ™¶ç³»éœ€è¦"
        bind:input="handleLatticeCInput"
      />

      <calculator-input
        wx:if="{{crystalIndex === 5}}"
        label="è§’åº¦ Î±"
        value="{{alpha}}"
        type="digit"
        placeholder="90"
        unit="Â°"
        icon="âˆ "
        hint="ä¸‰æ–œæ™¶ç³»éœ€è¦"
        bind:input="handleAlphaInput"
      />

      <calculator-input
        wx:if="{{crystalIndex >= 4}}"
        label="è§’åº¦ Î²"
        value="{{beta}}"
        type="digit"
        placeholder="90"
        unit="Â°"
        icon="âˆ "
        hint="å•æ–œ/ä¸‰æ–œæ™¶ç³»éœ€è¦"
        bind:input="handleBetaInput"
      />

      <calculator-input
        wx:if="{{crystalIndex === 5}}"
        label="è§’åº¦ Î³"
        value="{{gamma}}"
        type="digit"
        placeholder="90"
        unit="Â°"
        icon="âˆ "
        hint="ä¸‰æ–œæ™¶ç³»éœ€è¦"
        bind:input="handleGammaInput"
      />

      <view class="divider-line"></view>

      <calculator-input
        label="å®æµ‹å¯†åº¦ï¼ˆå¯é€‰ï¼‰"
        value="{{measuredDensity}}"
        type="digit"
        placeholder="ä¾‹å¦‚ï¼š4.23"
        unit="g/cmÂ³"
        icon="âš—ï¸"
        hint="è¾“å…¥åå°†è®¡ç®—è‡´å¯†åº¦"
        bind:input="handleMeasuredDensityInput"
      />
    </view>

    <view class="button-group">
      <button class="calc-button primary" bindtap="calculateDensity">è®¡ç®—</button>
      <button class="calc-button" bindtap="clearResult">æ¸…ç©º</button>
    </view>

    <result-card wx:if="{{densityResultText}}" title="è®¡ç®—ç»“æœ">
      <view class="result-text">{{densityResultText}}</view>
    </result-card>
  </view>

  <!-- æ™¶èƒä½“ç§¯è®¡ç®— -->
  <view wx:if="{{currentTool === 'volume'}}" class="tool-content">
    <view class="tool-intro">
      <text class="intro-title">ğŸ”· æ™¶èƒä½“ç§¯è®¡ç®—</text>
      <text class="intro-desc">æ ¹æ®æ™¶æ ¼å‚æ•°è®¡ç®—æ™¶èƒä½“ç§¯</text>
    </view>

    <view class="input-section">
      <view class="picker-field">
        <text class="picker-label">æ™¶ç³»</text>
        <picker mode="selector" range="{{crystalSystems}}" value="{{crystalIndex}}" bindchange="handleCrystalSystemChange">
          <view class="picker-value">{{crystalSystems[crystalIndex]}}</view>
        </picker>
      </view>

      <calculator-input
        label="æ™¶æ ¼å‚æ•° a"
        value="{{volumeLatticeA}}"
        type="digit"
        placeholder="ä¾‹å¦‚ï¼š5.0"
        unit="Ã…"
        icon="ğŸ“"
        bind:input="handleVolumeLatticeAInput"
      />

      <calculator-input
        wx:if="{{crystalIndex >= 2}}"
        label="æ™¶æ ¼å‚æ•° b"
        value="{{volumeLatticeB}}"
        type="digit"
        placeholder="åŒa"
        unit="Ã…"
        icon="ğŸ“"
        bind:input="handleVolumeLatticeBInput"
      />

      <calculator-input
        wx:if="{{crystalIndex >= 1}}"
        label="æ™¶æ ¼å‚æ•° c"
        value="{{volumeLatticeC}}"
        type="digit"
        placeholder="åŒa"
        unit="Ã…"
        icon="ğŸ“"
        bind:input="handleVolumeLatticeCInput"
      />

      <calculator-input
        wx:if="{{crystalIndex >= 4}}"
        label="è§’åº¦ Î²"
        value="{{volumeBeta}}"
        type="digit"
        placeholder="90"
        unit="Â°"
        icon="âˆ "
        hint="å•æ–œæ™¶ç³»éœ€è¦"
        bind:input="handleVolumeBetaInput"
      />
    </view>

    <view class="button-group">
      <button class="calc-button primary" bindtap="calculateVolume">è®¡ç®—</button>
      <button class="calc-button" bindtap="clearResult">æ¸…ç©º</button>
    </view>

    <result-card wx:if="{{volumeResultText}}" title="è®¡ç®—ç»“æœ">
      <view class="result-text">{{volumeResultText}}</view>
    </result-card>
  </view>

  <!-- dé—´è·è®¡ç®— -->
  <view wx:if="{{currentTool === 'd-spacing'}}" class="tool-content">
    <view class="tool-intro">
      <text class="intro-title">ğŸ“ æ™¶é¢é—´è·è®¡ç®—</text>
      <text class="intro-desc">è®¡ç®—æŒ‡å®šæ™¶é¢çš„dé—´è·</text>
    </view>

    <view class="input-section">
      <view class="picker-field">
        <text class="picker-label">æ™¶ç³»</text>
        <picker mode="selector" range="{{crystalSystems}}" value="{{crystalIndex}}" bindchange="handleCrystalSystemChange">
          <view class="picker-value">{{crystalSystems[crystalIndex]}}</view>
        </picker>
      </view>

      <view class="miller-inputs">
        <text class="field-label">MilleræŒ‡æ•° (hkl)</text>
        <view class="miller-row">
          <input class="miller-input" type="number" value="{{millerH}}" placeholder="h" bindinput="handleMillerHInput" />
          <input class="miller-input" type="number" value="{{millerK}}" placeholder="k" bindinput="handleMillerKInput" />
          <input class="miller-input" type="number" value="{{millerL}}" placeholder="l" bindinput="handleMillerLInput" />
        </view>
      </view>

      <calculator-input
        label="æ™¶æ ¼å‚æ•° a"
        value="{{dLatticeA}}"
        type="digit"
        placeholder="ä¾‹å¦‚ï¼š5.0"
        unit="Ã…"
        icon="ğŸ“"
        bind:input="handleDLatticeAInput"
      />

      <calculator-input
        wx:if="{{crystalIndex >= 2}}"
        label="æ™¶æ ¼å‚æ•° b"
        value="{{dLatticeB}}"
        type="digit"
        placeholder="åŒa"
        unit="Ã…"
        icon="ğŸ“"
        bind:input="handleDLatticeBInput"
      />

      <calculator-input
        wx:if="{{crystalIndex >= 1}}"
        label="æ™¶æ ¼å‚æ•° c"
        value="{{dLatticeC}}"
        type="digit"
        placeholder="åŒa"
        unit="Ã…"
        icon="ğŸ“"
        bind:input="handleDLatticeCInput"
      />
    </view>

    <view class="button-group">
      <button class="calc-button primary" bindtap="calculateD">è®¡ç®—</button>
      <button class="calc-button" bindtap="clearResult">æ¸…ç©º</button>
    </view>

    <result-card wx:if="{{dResultText}}" title="è®¡ç®—ç»“æœ">
      <view class="result-text">{{dResultText}}</view>
    </result-card>
  </view>

  <!-- å¯¼å‡ºæŒ‰é’® -->
  <view wx:if="{{densityResultText || volumeResultText || dResultText}}" class="export-button" bindtap="exportResult">
    <text>ğŸ“¤ å¯¼å‡ºç»“æœ</text>
  </view>
</view>

