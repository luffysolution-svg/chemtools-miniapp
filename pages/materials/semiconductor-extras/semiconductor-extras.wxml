<view class="semiconductor-extras-page">
  <!-- 页面头部 -->
  <view class="page-header">
    <text class="header-icon">🔦</text>
    <view class="header-content">
      <view class="header-title">半导体小工具</view>
      <view class="header-desc">带隙-波长转换、光谱区段、少子近似计算</view>
    </view>
  </view>

  <!-- 工具选择 -->
  <view class="section-card">
    <view class="tool-tabs">
      <view 
        wx:for="{{tools}}" 
        wx:key="id"
        class="tool-tab {{currentTool === item.id ? 'active' : ''}}"
        data-tool="{{item.id}}"
        bindtap="switchTool"
      >
        <text class="tab-icon">{{item.icon}}</text>
        <text class="tab-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- 工具1: Eg-λ转换 -->
  <view wx:if="{{currentTool === 'eg-lambda'}}" class="tool-content">
    <view class="section-card">
      <view class="section-title">💡 Eg ↔ λ 转换</view>
      <view class="section-description">根据 E(eV) = 1240/λ(nm) 互算带隙与波长</view>

      <view class="convert-mode">
        <view class="mode-selector">
          <button 
            class="mode-btn {{egLambdaMode === 'eg-to-lambda' ? 'active' : ''}}"
            data-mode="eg-to-lambda"
            bindtap="switchEgLambdaMode"
          >
            Eg → λ
          </button>
          <button 
            class="mode-btn {{egLambdaMode === 'lambda-to-eg' ? 'active' : ''}}"
            data-mode="lambda-to-eg"
            bindtap="switchEgLambdaMode"
          >
            λ → Eg
          </button>
        </view>
      </view>

      <view class="form-section">
        <calculator-input
          wx:if="{{egLambdaMode === 'eg-to-lambda'}}"
          label="带隙 Eg (eV)"
          type="digit"
          value="{{egValue}}"
          placeholder="例如：3.2"
          validator="positive"
          hint="输入半导体带隙值"
          bindinput="handleEgInput"
        />
        <calculator-input
          wx:else
          label="波长 λ (nm)"
          type="digit"
          value="{{lambdaValue}}"
          placeholder="例如：400"
          validator="positive"
          hint="输入光波长值"
          bindinput="handleLambdaInput"
        />

        <view class="action-buttons">
          <button class="btn-primary" bindtap="calculateEgLambda">转换</button>
          <button class="btn-secondary" bindtap="resetEgLambda">清空</button>
        </view>
      </view>

      <result-card
        wx:if="{{egLambdaResult}}"
        title="转换结果"
        result="{{egLambdaResultText}}"
        hint="{{egLambdaHint}}"
        show-copy="{{true}}"
      >
        <view class="conversion-result">
          <view class="result-value">{{egLambdaResult}}</view>
          <view class="result-spectrum" wx:if="{{spectrumRegion}}">
            光谱区域：<text class="spectrum-tag">{{spectrumRegion}}</text>
          </view>
        </view>
      </result-card>

      <!-- 光谱区段参考 -->
      <view class="reference-card">
        <view class="reference-title">📊 光谱区段参考</view>
        <view class="spectrum-bands">
          <view wx:for="{{spectrumBands}}" wx:key="name" class="band-item {{item.class}}">
            <view class="band-name">{{item.name}}</view>
            <view class="band-range">{{item.range}}</view>
            <view class="band-energy">{{item.energy}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 工具2: 少子近似 -->
  <view wx:if="{{currentTool === 'minority'}}" class="tool-content">
    <view class="section-card">
      <view class="section-title">⚡ 少子近似计算</view>
      <view class="section-description">本征半导体、掺杂半导体的载流子浓度估算</view>

      <view class="form-section">
        <view class="form-row">
          <view class="form-label">半导体类型</view>
          <picker mode="selector" range="{{semiconductorTypes}}" value="{{semiconductorTypeIndex}}" bindchange="handleSemiconductorTypeChange">
            <view class="picker-display">
              <text>{{semiconductorTypes[semiconductorTypeIndex]}}</text>
              <text class="picker-arrow">▼</text>
            </view>
          </picker>
        </view>

        <calculator-input
          label="本征载流子浓度 nᵢ (cm⁻³)"
          type="digit"
          value="{{niValue}}"
          placeholder="例如：1.5e10 (Si@300K)"
          hint="硅室温下约 1.5×10¹⁰ cm⁻³"
          bindinput="handleNiInput"
        />

        <calculator-input
          wx:if="{{semiconductorTypeIndex !== 0}}"
          label="{{semiconductorTypeIndex === 1 ? '施主浓度 Nd (cm⁻³)' : '受主浓度 Na (cm⁻³)'}}"
          type="digit"
          value="{{dopantValue}}"
          placeholder="例如：1e15"
          hint="掺杂浓度"
          bindinput="handleDopantInput"
        />

        <view class="action-buttons">
          <button class="btn-primary" bindtap="calculateMinority">计算</button>
          <button class="btn-secondary" bindtap="resetMinority">清空</button>
        </view>
      </view>

      <result-card
        wx:if="{{minorityResult}}"
        title="计算结果"
        result="{{minorityResultText}}"
        hint="{{minorityHint}}"
        show-copy="{{true}}"
      >
        <view class="minority-result">
          <view class="result-grid">
            <view class="result-item">
              <text class="item-label">电子浓度 n</text>
              <text class="item-value">{{minorityN}}</text>
            </view>
            <view class="result-item">
              <text class="item-label">空穴浓度 p</text>
              <text class="item-value">{{minorityP}}</text>
            </view>
            <view class="result-item">
              <text class="item-label">多数载流子</text>
              <text class="item-value">{{majorityCarrier}}</text>
            </view>
            <view class="result-item">
              <text class="item-label">少数载流子</text>
              <text class="item-value">{{minorityCarrier}}</text>
            </view>
          </view>
        </view>
      </result-card>

      <!-- 说明卡片 -->
      <view class="info-card">
        <view class="info-header">
          <text class="info-icon">📖</text>
          <text>公式说明</text>
        </view>
        <view class="info-content">
          <view class="formula-item">
            <text class="formula-label">质量作用定律：</text>
            <text class="formula">n × p = nᵢ²</text>
          </view>
          <view class="formula-item">
            <text class="formula-label">n型半导体（Nd >> nᵢ）：</text>
            <text class="formula">n ≈ Nd，p ≈ nᵢ²/Nd</text>
          </view>
          <view class="formula-item">
            <text class="formula-label">p型半导体（Na >> nᵢ）：</text>
            <text class="formula">p ≈ Na，n ≈ nᵢ²/Na</text>
          </view>
          <view class="formula-item">
            <text class="formula-label">本征半导体：</text>
            <text class="formula">n = p = nᵢ</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 工具3: 常用参数 -->
  <view wx:if="{{currentTool === 'parameters'}}" class="tool-content">
    <view class="section-card">
      <view class="section-title">📋 常用半导体参数</view>
      <view class="section-description">室温下常见半导体材料的本征载流子浓度</view>

      <view class="params-table">
        <view class="table-header">
          <view class="table-cell">材料</view>
          <view class="table-cell">Eg (eV)</view>
          <view class="table-cell">nᵢ (cm⁻³)</view>
          <view class="table-cell">温度</view>
        </view>
        <view wx:for="{{commonSemiconductors}}" wx:key="name" class="table-row">
          <view class="table-cell">{{item.name}}</view>
          <view class="table-cell">{{item.eg}}</view>
          <view class="table-cell">{{item.ni}}</view>
          <view class="table-cell">{{item.temp}}</view>
        </view>
      </view>

      <view class="tip-card">
        <view class="tip-header">
          <text class="tip-icon">💡</text>
          <text>使用提示</text>
        </view>
        <view class="tip-content">
          <text>• nᵢ 随温度指数增加，T↑ → nᵢ↑</text>
          <text>• 本征载流子浓度：nᵢ ∝ exp(-Eg/2kT)</text>
          <text>• 室温指 300K (27°C)</text>
          <text>• 掺杂浓度通常在 10¹⁴ ~ 10¹⁹ cm⁻³</text>
        </view>
      </view>
    </view>
  </view>
</view>

